<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?22c6a7b04eda79bc77678ca5c629fd77";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¿ƒæƒ…æ—¥è®° - è®°å½•ç¾å¥½æ¯ä¸€å¤©</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* æ¬¢è¿é¡µæ ·å¼ */
    .welcome-page {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      position: relative;
    }

    .circles {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
    }

    .circles li {
      position: absolute;
      list-style: none;
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.2);
      animation: float 25s linear infinite;
      bottom: -150px;
      border-radius: 50%;
    }

    .circles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
    .circles li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; }
    .circles li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
    .circles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; }
    .circles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
    .circles li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }

    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-1000px) rotate(720deg); opacity: 0; }
    }

    .welcome-content {
      text-align: center;
      color: white;
      z-index: 1;
      animation: fadeIn 1s;
    }

    .welcome-content h1 {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: slideDown 0.8s;
    }

    .welcome-content .subtitle {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      opacity: 0.9;
    }

    .welcome-content .description {
      font-size: 1.1rem;
      margin-bottom: 2rem;
      opacity: 0.85;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }

    .btn {
      padding: 15px 40px;
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .btn-start {
      background: white;
      color: #667eea;
    }

    .btn-start:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    .btn-back {
      background: #f0f0f0;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .btn-back:hover {
      background: #e0e0e0;
      transform: translateX(-3px);
    }

    /* é€šç”¨å®¹å™¨ */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ç™»å½•æ³¨å†Œé¡µé¢ */
    .auth-page {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .auth-card {
      background: white;
      border-radius: 20px;
      padding: 40px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .auth-card h2 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 28px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }

    .input-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn-primary {
      width: 100%;
      background: #667eea;
      color: white;
      padding: 14px;
      border-radius: 8px;
      font-size: 16px;
    }

    .auth-switch {
      text-align: center;
      margin-top: 20px;
      color: #666;
    }

    .auth-switch a {
      color: #667eea;
      text-decoration: none;
      font-weight: bold;
    }

    /* ä¸»é¡µé¢ */
    .main-page {
      padding: 20px 0;
    }

    .header {
      background: white;
      border-radius: 16px;
      padding: 20px 30px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      flex-wrap: wrap;
      gap: 10px;
    }

    .header h1 {
      font-size: 24px;
      color: #333;
      flex: 1;
      min-width: 200px;
    }

    .current-time {
      color: #666;
      font-size: 14px;
      font-weight: 500;
      padding: 8px 16px;
      background: #f5f5f5;
      border-radius: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .current-time::before {
      content: 'ğŸ•’';
      font-size: 16px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .btn-logout {
      background: #f0f0f0;
      color: #333;
      padding: 8px 20px;
      border-radius: 8px;
      font-size: 14px;
    }

    /* åŠŸèƒ½å¡ç‰‡ */
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .feature-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s;
    }

    .feature-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .feature-card h3 {
      font-size: 20px;
      color: #333;
      margin-bottom: 10px;
    }

    .feature-card p {
      color: #666;
      line-height: 1.6;
    }

    /* æ¨¡æ€æ¡† */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      animation: fadeIn 0.3s;
    }

    .modal.active {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 40px;
      width: 600px;
      max-width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUp 0.3s;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .modal-header h2 {
      font-size: 24px;
      color: #333;
    }

    .btn-close {
      background: #f0f0f0;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* å¿ƒæƒ…æ ‘æ´ */
    .mood-selector {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .mood-option {
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .mood-option:hover {
      border-color: #667eea;
      transform: translateY(-4px);
    }

    .mood-option.active {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .mood-emoji {
      font-size: 48px;
      display: block;
    }

    .mood-label {
      font-size: 14px;
      color: #666;
      margin-top: 8px;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      resize: vertical;
    }

    /* å½•éŸ³æ§åˆ¶ */
    .recording-controls {
      text-align: center;
      padding: 30px;
    }

    .record-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #f44336;
      color: white;
      border: none;
      font-size: 32px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3);
    }

    .record-btn:hover {
      transform: scale(1.1);
    }

    .record-btn.recording {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3); }
      50% { box-shadow: 0 4px 40px rgba(244, 67, 54, 0.6); }
    }

    .recording-time {
      margin-top: 20px;
      font-size: 24px;
      color: #333;
      font-weight: bold;
    }

    /* å£°éŸ³åº“ */
    .sound-list {
      display: grid;
      gap: 15px;
    }

    .sound-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .sound-info {
      flex: 1;
    }

    .sound-type {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin-right: 10px;
    }

    .sound-type.happy {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .sound-type.sad {
      background: #ffebee;
      color: #c62828;
    }

    .btn-play {
      background: #667eea;
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
    }

    /* æŠ¥å‘Šé¡µé¢ */
    .report-page {
      padding: 20px 0;
    }

    .report-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.5s;
    }

    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .report-header h2 {
      font-size: 28px;
      color: #333;
    }

    .date-selector {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .date-selector input {
      padding: 8px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      text-align: center;
    }

    .stat-value {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    canvas {
      width: 100%;
      height: 300px;
      margin: 20px 0;
    }

    .analysis-section {
      margin-top: 30px;
    }

    .analysis-card {
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .analysis-card h3 {
      font-size: 20px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .suggestions-list {
      list-style: none;
      display: grid;
      gap: 15px;
    }

    .suggestions-list li {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .suggestions-list li span:first-child {
      font-size: 24px;
      flex-shrink: 0;
    }

    /* ç¿»é¡µæ•ˆæœ */
    .page-flip {
      perspective: 1500px;
    }

    .flip-card {
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.8s;
    }

    .flip-card.flipped {
      transform: rotateY(180deg);
    }

    .flip-front, .flip-back {
      backface-visibility: hidden;
    }

    .flip-back {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      transform: rotateY(180deg);
    }

    /* åŠ¨ç”» */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* æ•°æ®å†å²æ ·å¼ */
    .data-history-container {
      max-height: 600px;
      overflow-y: auto;
    }

    .filter-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 10px;
    }

    .filter-tab {
      padding: 8px 20px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      border-radius: 8px 8px 0 0;
      transition: all 0.3s;
    }

    .filter-tab:hover {
      background: #f5f5f5;
      color: #333;
    }

    .filter-tab.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: bold;
    }

    .data-history-list {
      display: grid;
      gap: 15px;
    }

    .data-item {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #667eea;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .data-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .data-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .data-item-type {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .data-item-date {
      font-size: 13px;
      color: #666;
    }

    .data-item-mood {
      font-size: 24px;
      margin-right: 10px;
    }

    .data-item-content {
      margin-top: 10px;
      color: #333;
      line-height: 1.6;
    }

    .data-item-audio {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .data-item-audio audio {
      flex: 1;
      height: 35px;
    }

    .no-data {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .no-data-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .welcome-content h1 { font-size: 2.5rem; }
      .mood-selector { grid-template-columns: repeat(3, 1fr); }
      .features { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
    }

    /* éšè—é¡µé¢ */
    .page { display: none; }
    .page.active { display: block; }

    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
    }

    .message.success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .message.error {
      background: #ffebee;
      color: #c62828;
    }
  </style>
</head>
<body>
  <!-- æ¬¢è¿é¡µ -->
  <div class="page welcome-page active" id="welcomePage">
    <div class="circles">
      <li></li><li></li><li></li><li></li><li></li><li></li>
    </div>
    <div class="welcome-content">
      <h1>ğŸŒˆ å¿ƒæƒ…æ—¥è®°</h1>
      <p class="subtitle">è®°å½•ç¾å¥½æ¯ä¸€å¤©</p>
      <p class="description">
        åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥è‡ªç”±åœ°è¡¨è¾¾è‡ªå·±çš„å¿ƒæƒ…ï¼Œè®°å½•ç”Ÿæ´»çš„ç‚¹æ»´ã€‚
        é€šè¿‡æ–‡å­—ã€è¯­éŸ³å’Œå£°éŸ³ï¼Œæ•æ‰æ¯ä¸€ä¸ªæƒ…ç»ªç¬é—´ã€‚
        è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢å†…å¿ƒä¸–ç•Œï¼Œå‘ç°ç”Ÿæ´»çš„ç¾å¥½ã€‚
      </p>
      <button class="btn btn-start" onclick="startJourney()">å¼€å§‹è®°å½•</button>
    </div>
  </div>

  <!-- ç™»å½•æ³¨å†Œé¡µ -->
  <div class="page auth-page" id="authPage">
    <div class="auth-card">
      <button class="btn btn-back" onclick="backToWelcome()" style="position: absolute; top: 20px; left: 20px; padding: 8px 16px;">â† è¿”å›</button>
      <h2 id="authTitle">ç™»å½•</h2>
      <div id="authMessage"></div>
      <form id="authForm" onsubmit="handleAuth(event)">
        <div class="input-group">
          <label>ç”¨æˆ·å</label>
          <input type="text" id="authUsername" required>
        </div>
        <div class="input-group">
          <label>å¯†ç </label>
          <input type="password" id="authPassword" required>
        </div>
        <button type="submit" class="btn btn-primary" id="authSubmit">ç™»å½•</button>
      </form>
      <div class="auth-switch">
        <span id="authSwitchText">è¿˜æ²¡æœ‰è´¦å·?</span>
        <a href="#" onclick="toggleAuthMode(); return false;" id="authSwitchLink">ç«‹å³æ³¨å†Œ</a>
      </div>
    </div>
  </div>

  <!-- ä¸»é¡µé¢ -->
  <div class="page main-page" id="mainPage">
    <div class="container">
      <div class="header">
        <h1>æ¬¢è¿å›æ¥,<span id="displayUsername"></span></h1>
        <div class="current-time" id="currentTime"></div>
        <div class="user-info">
          <button class="btn btn-primary" onclick="showDataHistory()" style="margin-right: 10px;">ğŸ“Š å¿ƒæƒ…æ•°æ®</button>
          <button class="btn btn-logout" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>
      </div>

      <div class="features">
        <div class="feature-card" onclick="openModal('moodModal')">
          <div class="feature-icon">ğŸ’­</div>
          <h3>å¿ƒæƒ…æ ‘æ´</h3>
          <p>è®°å½•ä»Šå¤©çš„å¿ƒæƒ…ï¼Œç”¨æ–‡å­—å’Œè¡¨æƒ…è¡¨è¾¾ä½ çš„æ„Ÿå—</p>
        </div>
        <div class="feature-card" onclick="openModal('voiceModal')">
          <div class="feature-icon">ğŸ¤</div>
          <h3>è¯­éŸ³æ—¥è®°</h3>
          <p>ç”¨å£°éŸ³è®°å½•ç”Ÿæ´»ï¼Œæ•æ‰æ¯ä¸€ä¸ªçœŸå®çš„ç¬é—´</p>
        </div>
        <div class="feature-card" onclick="openModal('soundModal')">
          <div class="feature-icon">ğŸµ</div>
          <h3>å£°éŸ³æ”¶è—</h3>
          <p>æ”¶å½•è®©ä½ å¿«ä¹æˆ–æ„ŸåŠ¨çš„å£°éŸ³ï¼Œå»ºç«‹ä¸“å±å£°éŸ³åº“</p>
        </div>
      </div>

      <div class="report-card">
        <div class="report-header">
          <h2>æˆ‘çš„å¿ƒæƒ…æŠ¥å‘Š</h2>
          <button class="btn btn-primary" onclick="showReport()">æŸ¥çœ‹æŠ¥å‘Š</button>
        </div>
      </div>
    </div>
  </div>

  <!-- æŠ¥å‘Šé¡µ -->
  <div class="page report-page" id="reportPage">
    <div class="container">
      <button class="btn btn-back" onclick="backToMain()" style="margin-bottom: 20px;">â† è¿”å›ä¸»é¡µ</button>
      <div class="report-card">
        <div class="report-header">
          <h2>ğŸ“Š å¿ƒæƒ…åˆ†ææŠ¥å‘Š</h2>
          <div class="date-selector">
            <input type="date" id="startDate">
            <span>è‡³</span>
            <input type="date" id="endDate">
            <button class="btn btn-primary" onclick="generateReport()">ç”ŸæˆæŠ¥å‘Š</button>
          </div>
        </div>

        <div class="stats-grid" id="statsGrid"></div>

        <div>
          <h3>å¿ƒæƒ…è¶‹åŠ¿å›¾</h3>
          <canvas id="moodChart"></canvas>
        </div>

        <div class="analysis-section" id="analysisSection"></div>

        <div style="text-align: center; margin-top: 30px;">
          <button class="btn btn-primary" onclick="backToMain()">è¿”å›ä¸»é¡µ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- å¿ƒæƒ…æ ‘æ´æ¨¡æ€æ¡† -->
  <div class="modal" id="moodModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ’­ ä»Šå¤©çš„å¿ƒæƒ…</h2>
        <button class="btn-close" onclick="closeModal('moodModal')">Ã—</button>
      </div>
      <form onsubmit="saveMood(event)">
        <div class="input-group">
          <label>é€‰æ‹©å¿ƒæƒ…</label>
          <div class="mood-selector">
            <div class="mood-option" data-mood="1">
              <span class="mood-emoji">ğŸ˜¢</span>
              <div class="mood-label">å¾ˆç³Ÿç³•</div>
            </div>
            <div class="mood-option" data-mood="2">
              <span class="mood-emoji">ğŸ˜”</span>
              <div class="mood-label">ä¸å¤ªå¥½</div>
            </div>
            <div class="mood-option" data-mood="3">
              <span class="mood-emoji">ğŸ˜</span>
              <div class="mood-label">ä¸€èˆ¬èˆ¬</div>
            </div>
            <div class="mood-option" data-mood="4">
              <span class="mood-emoji">ğŸ˜Š</span>
              <div class="mood-label">è¿˜ä¸é”™</div>
            </div>
            <div class="mood-option" data-mood="5">
              <span class="mood-emoji">ğŸ˜„</span>
              <div class="mood-label">éå¸¸å¥½</div>
            </div>
          </div>
        </div>
        <div class="input-group">
          <label>ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆ?</label>
          <textarea id="moodText" placeholder="åˆ†äº«ä½ çš„æ•…äº‹..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">ä¿å­˜</button>
      </form>
    </div>
  </div>

  <!-- è¯­éŸ³æ—¥è®°æ¨¡æ€æ¡† -->
  <div class="modal" id="voiceModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ¤ è¯­éŸ³æ—¥è®°</h2>
        <button class="btn-close" onclick="closeModal('voiceModal')">Ã—</button>
      </div>
      <div class="recording-controls">
        <button class="record-btn" id="recordBtn" onclick="toggleRecording()">
          <span id="recordIcon">ğŸ¤</span>
        </button>
        <div class="recording-time" id="recordingTime">00:00</div>
        <p style="margin-top: 20px; color: #666;">ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³</p>
      </div>
      <div class="input-group" style="margin-top: 30px;">
        <label>æ·»åŠ æ–‡å­—æè¿°ï¼ˆå¯é€‰ï¼‰</label>
        <textarea id="voiceText" placeholder="ä¸ºè¿™æ®µå½•éŸ³æ·»åŠ ä¸€äº›æ–‡å­—è¯´æ˜..."></textarea>
      </div>
      <button class="btn btn-primary" onclick="saveVoice()" style="width: 100%;">ä¿å­˜å½•éŸ³</button>
    </div>
  </div>

  <!-- å£°éŸ³æ”¶è—æ¨¡æ€æ¡† -->
  <div class="modal" id="soundModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸµ å£°éŸ³æ”¶è—</h2>
        <button class="btn-close" onclick="closeModal('soundModal')">Ã—</button>
      </div>
      <div class="input-group">
        <label>å£°éŸ³ç±»å‹</label>
        <select id="soundType" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
          <option value="happy">è®©æˆ‘å¿«ä¹çš„å£°éŸ³</option>
          <option value="sad">è®©æˆ‘å‹æŠ‘çš„å£°éŸ³</option>
        </select>
      </div>
      <div class="recording-controls">
        <button class="record-btn" id="soundRecordBtn" onclick="toggleSoundRecording()">
          <span id="soundRecordIcon">ğŸ¤</span>
        </button>
        <div class="recording-time" id="soundRecordingTime">00:00</div>
      </div>
      <div class="input-group">
         <label>å£°éŸ³æè¿°</label>
         <input type="text" id="soundDescription" placeholder="ä¾‹å¦‚ï¼šé›¨å£°ã€é¸Ÿé¸£ã€éŸ³ä¹ç­‰">
       </div>
       <button class="btn btn-primary" onclick="saveSound()" style="width: 100%;">ä¿å­˜å£°éŸ³</button>
     </div>
   </div>

  <!-- æ•°æ®å†å²æ¨¡æ€æ¡† -->
  <div class="modal" id="dataHistoryModal">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h2>ğŸ“Š æˆ‘çš„å¿ƒæƒ…æ•°æ®</h2>
        <button class="btn-close" onclick="closeModal('dataHistoryModal')">Ã—</button>
      </div>
      <div class="data-history-container">
        <div class="filter-tabs">
          <button class="filter-tab active" onclick="filterData('all')">å…¨éƒ¨</button>
          <button class="filter-tab" onclick="filterData('mood')">å¿ƒæƒ…è®°å½•</button>
          <button class="filter-tab" onclick="filterData('voice')">è¯­éŸ³æ—¥è®°</button>
          <button class="filter-tab" onclick="filterData('sound')">å£°éŸ³æ”¶è—</button>
        </div>
        <div id="dataHistoryList" class="data-history-list">
          <!-- æ•°æ®åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </div>
  </div>

   <script>
     // æ•°æ®å­˜å‚¨
     let currentUser = null;
     let isAuthMode = 'login'; // login or register
     let mediaRecorder = null;
     let audioChunks = [];
     let recordingTimer = null;
     let recordingSeconds = 0;
     let soundMediaRecorder = null;
     let soundAudioChunks = [];
     let soundRecordingTimer = null;
     let soundRecordingSeconds = 0;
     let selectedMood = null;

     // åˆå§‹åŒ–
     function init() {
       const user = localStorage.getItem('currentUser');
       if (user) {
         currentUser = user;
         checkAuth();
       }
       
       // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
       const today = new Date();
       const sevenDaysAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
       document.getElementById('endDate').valueAsDate = today;
       document.getElementById('startDate').valueAsDate = sevenDaysAgo;

       // å¿ƒæƒ…é€‰æ‹©å™¨äº‹ä»¶
       document.querySelectorAll('.mood-option').forEach(option => {
         option.addEventListener('click', function() {
           document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('active'));
           this.classList.add('active');
           selectedMood = this.dataset.mood;
         });
       });
     }

     // å¼€å§‹æ—…ç¨‹
     function startJourney() {
       if (currentUser) {
         showPage('mainPage');
       } else {
         showPage('authPage');
       }
     }

     // æ˜¾ç¤ºé¡µé¢
     function showPage(pageId) {
       document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
       document.getElementById(pageId).classList.add('active');
       
       if (pageId === 'mainPage') {
         document.getElementById('displayUsername').textContent = currentUser;
         updateCurrentTime();
         startTimeUpdate();
       }
     }

     // è¿”å›æ¬¢è¿é¡µ
     function backToWelcome() {
       showPage('welcomePage');
     }

     // åˆ‡æ¢è®¤è¯æ¨¡å¼
     function toggleAuthMode() {
       isAuthMode = isAuthMode === 'login' ? 'register' : 'login';
       const title = document.getElementById('authTitle');
       const submit = document.getElementById('authSubmit');
       const switchText = document.getElementById('authSwitchText');
       const switchLink = document.getElementById('authSwitchLink');
       
       if (isAuthMode === 'register') {
         title.textContent = 'æ³¨å†Œ';
         submit.textContent = 'æ³¨å†Œ';
         switchText.textContent = 'å·²æœ‰è´¦å·?';
         switchLink.textContent = 'ç«‹å³ç™»å½•';
       } else {
         title.textContent = 'ç™»å½•';
         submit.textContent = 'ç™»å½•';
         switchText.textContent = 'è¿˜æ²¡æœ‰è´¦å·?';
         switchLink.textContent = 'ç«‹å³æ³¨å†Œ';
       }
       document.getElementById('authMessage').innerHTML = '';
     }

     // å¤„ç†è®¤è¯
     function handleAuth(event) {
       event.preventDefault();
       const username = document.getElementById('authUsername').value.trim();
       const password = document.getElementById('authPassword').value;
       const messageDiv = document.getElementById('authMessage');
       
       if (!username || !password) {
         messageDiv.innerHTML = '<div class="message error">ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º</div>';
         return;
       }
       
       if (isAuthMode === 'register') {
         const users = JSON.parse(localStorage.getItem('users') || '{}');
         if (users[username]) {
           messageDiv.innerHTML = '<div class="message error">ç”¨æˆ·åå·²å­˜åœ¨</div>';
           return;
         }
         users[username] = password;
         localStorage.setItem('users', JSON.stringify(users));
         messageDiv.innerHTML = '<div class="message success">æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•</div>';
         setTimeout(() => {
           toggleAuthMode();
           document.getElementById('authForm').reset();
         }, 1500);
       } else {
         const users = JSON.parse(localStorage.getItem('users') || '{}');
         if (users[username] === password) {
           currentUser = username;
           localStorage.setItem('currentUser', username);
           document.getElementById('displayUsername').textContent = username;
           showPage('mainPage');
           document.getElementById('authForm').reset();
         } else {
           messageDiv.innerHTML = '<div class="message error">ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</div>';
         }
       }
     }

     // æ£€æŸ¥è®¤è¯
     function checkAuth() {
       const savedUser = localStorage.getItem('currentUser');
       if (savedUser) {
         const users = JSON.parse(localStorage.getItem('users') || '{}');
         if (users[savedUser]) {
           currentUser = savedUser;
           document.getElementById('displayUsername').textContent = currentUser;
           showPage('mainPage');
           return;
         } else {
           localStorage.removeItem('currentUser');
         }
       }
     }

     // é€€å‡ºç™»å½•
     function logout() {
       currentUser = null;
       localStorage.removeItem('currentUser');
       showPage('welcomePage');
     }

     // æ‰“å¼€æ¨¡æ€æ¡†
     function openModal(modalId) {
       document.getElementById(modalId).style.display = 'flex';
       selectedMood = null;
       document.querySelectorAll('.mood-option').forEach(o => o.classList.remove('active'));
     }

     // å…³é—­æ¨¡æ€æ¡†
     function closeModal(modalId) {
       document.getElementById(modalId).style.display = 'none';
       if (modalId === 'voiceModal' && mediaRecorder && mediaRecorder.state === 'recording') {
         mediaRecorder.stop();
       }
       if (modalId === 'soundModal' && soundMediaRecorder && soundMediaRecorder.state === 'recording') {
         soundMediaRecorder.stop();
       }
     }

     // ä¿å­˜å¿ƒæƒ…
     function saveMood(event) {
       event.preventDefault();
       if (!selectedMood) {
         alert('è¯·é€‰æ‹©å¿ƒæƒ…');
         return;
       }
       
       const text = document.getElementById('moodText').value;
       const record = {
         type: 'mood',
         mood: selectedMood,
         text: text,
         timestamp: new Date().toISOString()
       };
       
       saveRecord(record);
       document.getElementById('moodText').value = '';
       closeModal('moodModal');
       alert('ä¿å­˜æˆåŠŸï¼');
     }

     // å½•éŸ³ç›¸å…³
     function toggleRecording() {
       if (!mediaRecorder || mediaRecorder.state === 'inactive') {
         startRecording();
       } else {
         stopRecording();
       }
     }

     function startRecording() {
       navigator.mediaDevices.getUserMedia({ audio: true })
         .then(stream => {
           mediaRecorder = new MediaRecorder(stream);
           audioChunks = [];
           
           mediaRecorder.ondataavailable = (event) => {
             audioChunks.push(event.data);
           };
           
           mediaRecorder.start();
           document.getElementById('recordIcon').textContent = 'â¸ï¸';
           document.getElementById('recordBtn').classList.add('recording');
           
           recordingSeconds = 0;
           recordingTimer = setInterval(() => {
             recordingSeconds++;
             const minutes = Math.floor(recordingSeconds / 60);
             const seconds = recordingSeconds % 60;
             document.getElementById('recordingTime').textContent = 
               `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
           }, 1000);
         })
         .catch(err => alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼š' + err.message));
     }

     function stopRecording() {
       if (mediaRecorder && mediaRecorder.state === 'recording') {
         mediaRecorder.stop();
         clearInterval(recordingTimer);
         document.getElementById('recordIcon').textContent = 'ğŸ¤';
         document.getElementById('recordBtn').classList.remove('recording');
       }
     }

     function saveVoice() {
       if (!audioChunks || audioChunks.length === 0) {
         alert('è¯·å…ˆå½•éŸ³');
         return;
       }
       
       const text = document.getElementById('voiceText').value;
       const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
       const reader = new FileReader();
       
       reader.onloadend = () => {
         const record = {
           type: 'voice',
           text: text,
           audio: reader.result,
           duration: recordingSeconds,
           timestamp: new Date().toISOString()
         };
         
         saveRecord(record);
         document.getElementById('voiceText').value = '';
         document.getElementById('recordingTime').textContent = '00:00';
         audioChunks = [];
         closeModal('voiceModal');
         alert('ä¿å­˜æˆåŠŸï¼');
       };
       
       reader.readAsDataURL(audioBlob);
     }

     // å£°éŸ³æ”¶è—å½•éŸ³
     function toggleSoundRecording() {
       if (!soundMediaRecorder || soundMediaRecorder.state === 'inactive') {
         startSoundRecording();
       } else {
         stopSoundRecording();
       }
     }

     function startSoundRecording() {
       navigator.mediaDevices.getUserMedia({ audio: true })
         .then(stream => {
           soundMediaRecorder = new MediaRecorder(stream);
           soundAudioChunks = [];
           
           soundMediaRecorder.ondataavailable = (event) => {
             soundAudioChunks.push(event.data);
           };
           
           soundMediaRecorder.start();
           document.getElementById('soundRecordIcon').textContent = 'â¸ï¸';
           document.getElementById('soundRecordBtn').classList.add('recording');
           
           soundRecordingSeconds = 0;
           soundRecordingTimer = setInterval(() => {
             soundRecordingSeconds++;
             const minutes = Math.floor(soundRecordingSeconds / 60);
             const seconds = soundRecordingSeconds % 60;
             document.getElementById('soundRecordingTime').textContent = 
               `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
           }, 1000);
         })
         .catch(err => alert('æ— æ³•è®¿é—®éº¦å…‹é£ï¼š' + err.message));
     }

     function stopSoundRecording() {
       if (soundMediaRecorder && soundMediaRecorder.state === 'recording') {
         soundMediaRecorder.stop();
         clearInterval(soundRecordingTimer);
         document.getElementById('soundRecordIcon').textContent = 'ğŸ¤';
         document.getElementById('soundRecordBtn').classList.remove('recording');
       }
     }

     function saveSound() {
       if (!soundAudioChunks || soundAudioChunks.length === 0) {
         alert('è¯·å…ˆå½•éŸ³');
         return;
       }
       
       const type = document.getElementById('soundType').value;
       const description = document.getElementById('soundDescription').value;
       
       if (!description) {
         alert('è¯·è¾“å…¥å£°éŸ³æè¿°');
         return;
       }
       
       const audioBlob = new Blob(soundAudioChunks, { type: 'audio/webm' });
       const reader = new FileReader();
       
       reader.onloadend = () => {
         const record = {
           type: 'sound',
           soundType: type,
           description: description,
           audio: reader.result,
           duration: soundRecordingSeconds,
           timestamp: new Date().toISOString()
         };
         
         saveRecord(record);
         document.getElementById('soundDescription').value = '';
         document.getElementById('soundRecordingTime').textContent = '00:00';
         soundAudioChunks = [];
         closeModal('soundModal');
         alert('ä¿å­˜æˆåŠŸï¼');
       };
       
       reader.readAsDataURL(audioBlob);
     }

     // ä¿å­˜è®°å½•
     function saveRecord(record) {
       const key = `records_${currentUser}`;
       const records = JSON.parse(localStorage.getItem(key) || '[]');
       records.push(record);
       localStorage.setItem(key, JSON.stringify(records));
     }

     // è·å–è®°å½•
     function getRecords() {
       const key = `records_${currentUser}`;
       return JSON.parse(localStorage.getItem(key) || '[]');
     }

     // æ˜¾ç¤ºæŠ¥å‘Š
     function showReport() {
       // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨ä¸ºå½“å‰æ—¥æœŸ
       const today = new Date();
       const thirtyDaysAgo = new Date(today);
       thirtyDaysAgo.setDate(today.getDate() - 30);
       
       document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
       document.getElementById('endDate').value = today.toISOString().split('T')[0];
       
       showPage('reportPage');
       generateReport();
     }

     // è¿”å›ä¸»é¡µ
     function backToMain() {
       showPage('mainPage');
     }

     // ç”ŸæˆæŠ¥å‘Š
     function generateReport() {
       // å¦‚æœæ—¥æœŸè¾“å…¥æ¡†ä¸ºç©º,è®¾ç½®ä¸ºå½“å‰æ—¥æœŸ
       const startDateInput = document.getElementById('startDate');
       const endDateInput = document.getElementById('endDate');
       
       if (!startDateInput.value || !endDateInput.value) {
         const today = new Date();
         const thirtyDaysAgo = new Date(today);
         thirtyDaysAgo.setDate(today.getDate() - 30);
         
         if (!startDateInput.value) {
           startDateInput.value = thirtyDaysAgo.toISOString().split('T')[0];
         }
         if (!endDateInput.value) {
           endDateInput.value = today.toISOString().split('T')[0];
         }
       }
       
       const startDate = new Date(startDateInput.value);
       const endDate = new Date(endDateInput.value);
       endDate.setHours(23, 59, 59, 999);
       
       const allRecords = getRecords();
       const records = allRecords.filter(r => {
         const recordDate = new Date(r.date);
         return recordDate >= startDate && recordDate <= endDate;
       });
       
       // ç»Ÿè®¡æ•°æ®
       const moodRecords = records.filter(r => r.type === 'mood' && r.mood);
       const avgMood = moodRecords.length > 0 
         ? (moodRecords.reduce((sum, r) => sum + parseInt(r.mood), 0) / moodRecords.length).toFixed(1)
         : 0;
       
       const happyDays = moodRecords.filter(r => parseInt(r.mood) >= 4).length;
       const sadDays = moodRecords.filter(r => parseInt(r.mood) <= 2).length;
       
       // æ˜¾ç¤ºç»Ÿè®¡å¡ç‰‡
       const statsGrid = document.getElementById('statsGrid');
       statsGrid.innerHTML = `
         <div class="stat-card">
           <div class="stat-value">${avgMood}</div>
           <div class="stat-label">å¹³å‡å¿ƒæƒ…æŒ‡æ•°</div>
         </div>
         <div class="stat-card">
            <div class="stat-value">${records.length}</div>
            <div class="stat-label">æ€»è®°å½•æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${happyDays}</div>
            <div class="stat-label">å¼€å¿ƒå¤©æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${sadDays}</div>
            <div class="stat-label">ä½è½å¤©æ•°</div>
          </div>
        `;
        
        // ç»˜åˆ¶å›¾è¡¨
        drawChart(moodRecords, startDate, endDate);
        
        // ç”Ÿæˆåˆ†æå’Œå»ºè®®
        generateAnalysisAndAdvice(records, moodRecords, avgMood, happyDays, sadDays);
      }

      // ç»˜åˆ¶æŠ˜çº¿å›¾
      function drawChart(moodRecords, startDate, endDate) {
        const canvas = document.getElementById('moodChart');
        const ctx = canvas.getContext('2d');
        
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        
        const padding = 50;
        const chartWidth = canvas.width - padding * 2;
        const chartHeight = canvas.height - padding * 2;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // æŒ‰æ—¥æœŸåˆ†ç»„
        const dayData = new Map();
        moodRecords.forEach(record => {
          const date = new Date(record.date).toLocaleDateString();
          if (!dayData.has(date)) {
            dayData.set(date, []);
          }
          dayData.get(date).push(parseInt(record.mood));
        });
        
        // è®¡ç®—æ¯å¤©å¹³å‡å¿ƒæƒ…
        const dates = [];
        const avgMoods = [];
        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
          const dateStr = d.toLocaleDateString();
          dates.push(dateStr);
          if (dayData.has(dateStr)) {
            const moods = dayData.get(dateStr);
            const avg = moods.reduce((a, b) => a + b, 0) / moods.length;
            avgMoods.push(avg);
          } else {
            avgMoods.push(null);
          }
        }
        
        if (avgMoods.filter(m => m !== null).length === 0) {
          ctx.fillStyle = '#666';
          ctx.font = '16px sans-serif';
          ctx.textAlign = 'center';
          ctx.fillText('æš‚æ— æ•°æ®', canvas.width / 2, canvas.height / 2);
          return;
        }
        
        // ç»˜åˆ¶åæ ‡è½´
        ctx.strokeStyle = '#e0e0e0';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(padding, padding);
        ctx.lineTo(padding, canvas.height - padding);
        ctx.lineTo(canvas.width - padding, canvas.height - padding);
        ctx.stroke();
        
        // ç»˜åˆ¶Yè½´åˆ»åº¦
        ctx.fillStyle = '#666';
        ctx.font = '12px sans-serif';
        ctx.textAlign = 'right';
        for (let i = 0; i <= 5; i++) {
          const y = canvas.height - padding - (chartHeight * i / 5);
          ctx.fillText(i.toString(), padding - 10, y + 5);
          
          ctx.strokeStyle = '#f0f0f0';
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(padding, y);
          ctx.lineTo(canvas.width - padding, y);
          ctx.stroke();
        }
        
        // ç»˜åˆ¶æŠ˜çº¿
        ctx.strokeStyle = '#667eea';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        let firstPoint = true;
        avgMoods.forEach((mood, index) => {
          if (mood !== null) {
            const x = padding + (chartWidth * index / (dates.length - 1));
            const y = canvas.height - padding - (chartHeight * mood / 5);
            
            if (firstPoint) {
              ctx.moveTo(x, y);
              firstPoint = false;
            } else {
              ctx.lineTo(x, y);
            }
          }
        });
        
        ctx.stroke();
        
        // ç»˜åˆ¶æ•°æ®ç‚¹
        avgMoods.forEach((mood, index) => {
          if (mood !== null) {
            const x = padding + (chartWidth * index / (dates.length - 1));
            const y = canvas.height - padding - (chartHeight * mood / 5);
            
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();
          }
        });
        
        // ç»˜åˆ¶Xè½´æ—¥æœŸæ ‡ç­¾ï¼ˆæ¯éš”å‡ å¤©æ˜¾ç¤ºä¸€æ¬¡ï¼‰
        ctx.fillStyle = '#666';
        ctx.font = '11px sans-serif';
        ctx.textAlign = 'center';
        const labelStep = Math.max(1, Math.floor(dates.length / 7));
        dates.forEach((date, index) => {
          if (index % labelStep === 0) {
            const x = padding + (chartWidth * index / (dates.length - 1));
            const shortDate = date.split('/').slice(1).join('/');
            ctx.fillText(shortDate, x, canvas.height - padding + 20);
          }
        });
      }

      // ç”Ÿæˆåˆ†æå’Œå»ºè®®
      function generateAnalysisAndAdvice(allRecords, moodRecords, avgMood, happyDays, sadDays) {
        const analysisDiv = document.getElementById('moodAnalysis');
        const adviceDiv = document.getElementById('moodAdvice');
        
        // åˆ†æ
        let analysis = '<h3>ğŸ“Š å¿ƒæƒ…åˆ†æ</h3>';
        
        const happyRecords = moodRecords.filter(r => parseInt(r.mood) >= 4);
        const sadRecords = moodRecords.filter(r => parseInt(r.mood) <= 2);
        
        const happyTexts = happyRecords.map(r => r.text).filter(t => t).join(' ');
        const sadTexts = sadRecords.map(r => r.text).filter(t => t).join(' ');
        
        if (happyTexts) {
          const keywords = extractKeywords(happyTexts);
          if (keywords.length > 0) {
            analysis += '<p><strong>è®©ä½ å¼€å¿ƒçš„äº‹æƒ…ï¼š</strong>' + keywords.slice(0, 5).join('ã€') + '</p>';
          }
        }
        
        if (sadTexts) {
          const keywords = extractKeywords(sadTexts);
          if (keywords.length > 0) {
            analysis += '<p><strong>è®©ä½ ä¸å¼€å¿ƒçš„äº‹æƒ…ï¼š</strong>' + keywords.slice(0, 5).join('ã€') + '</p>';
          }
        }
        
        analysisDiv.innerHTML = analysis || '<p>æš‚æ— è¶³å¤Ÿæ•°æ®è¿›è¡Œåˆ†æ</p>';
        
        // å»ºè®®
        let advice = '<h3>ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</h3><ul>';
        
        // å¿ƒæƒ…åˆ¤æ–­
        if (avgMood >= 4) {
          advice += '<li>ğŸ˜Š <strong>å¿ƒæƒ…çŠ¶æ€ï¼š</strong>ä½ æœ€è¿‘çš„å¿ƒæƒ…çŠ¶æ€éå¸¸å¥½ï¼Œç»§ç»­ä¿æŒç§¯æä¹è§‚çš„æ€åº¦ï¼</li>';
        } else if (avgMood >= 3) {
          advice += '<li>ğŸ˜ <strong>å¿ƒæƒ…çŠ¶æ€ï¼š</strong>ä½ æœ€è¿‘çš„å¿ƒæƒ…è¾ƒä¸ºå¹³ç¨³ï¼Œå¯ä»¥å°è¯•åšä¸€äº›è®©è‡ªå·±å¼€å¿ƒçš„äº‹æƒ…ã€‚</li>';
        } else {
          advice += '<li>ğŸ˜” <strong>å¿ƒæƒ…çŠ¶æ€ï¼š</strong>ä½ æœ€è¿‘çš„å¿ƒæƒ…åä½ï¼Œå»ºè®®å¤šå…³æ³¨è‡ªå·±çš„æƒ…ç»ªå¥åº·ï¼Œå¿…è¦æ—¶å¯»æ±‚å¸®åŠ©ã€‚</li>';
        }
        
        // è¡Œä¸ºå»ºè®®
        if (happyRecords.length > 0) {
          advice += '<li>âœ¨ <strong>è¡Œä¸ºå»ºè®®ï¼š</strong>å¤šåšè®©ä½ å¼€å¿ƒçš„äº‹æƒ…ï¼Œä¿æŒç§¯æçš„ç”Ÿæ´»æ–¹å¼ã€‚</li>';
        }
        
        if (sadRecords.length > 0) {
          advice += '<li>âš ï¸ <strong>è¡Œä¸ºå»ºè®®ï¼š</strong>å°½é‡é¿å…æˆ–è°ƒæ•´è®©ä½ ä¸å¼€å¿ƒçš„äº‹æƒ…ï¼Œå­¦ä¼šæƒ…ç»ªç®¡ç†ã€‚</li>';
        }
        
        // å£°éŸ³å»ºè®®
        const positiveSound = allRecords.filter(r => r.type === 'sound' && r.soundType === 'positive');
        const negativeSound = allRecords.filter(r => r.type === 'sound' && r.soundType === 'negative');
        
        if (positiveSound.length > 0) {
          advice += '<li>ğŸµ <strong>å£°éŸ³å»ºè®®ï¼š</strong>å¤šå¬è®©ä½ æ„‰æ‚¦çš„å£°éŸ³ï¼Œå¦‚ï¼š' + 
            positiveSound.map(s => s.description).slice(0, 3).join('ã€') + 'ç­‰ã€‚</li>';
        }
        
        if (negativeSound.length > 0 && avgMood < 3) {
          advice += '<li>ğŸ”‡ <strong>å£°éŸ³å»ºè®®ï¼š</strong>å°½é‡é¿å…è®©ä½ ç´§å¼ æˆ–å‹æŠ‘çš„å£°éŸ³ã€‚</li>';
        }
        
        // è¯­éŸ³è®°å½•
        const voiceRecords = allRecords.filter(r => r.type === 'voice');
        if (voiceRecords.length > 0) {
          advice += '<li>ğŸ™ï¸ <strong>å»ºè®®ï¼š</strong>ç»§ç»­ä¿æŒè¯­éŸ³æ—¥è®°çš„ä¹ æƒ¯ï¼Œè¿™æœ‰åŠ©äºæƒ…ç»ªçš„è¡¨è¾¾å’Œé‡Šæ”¾ã€‚</li>';
        }
        
        advice += '</ul>';
        adviceDiv.innerHTML = advice;
      }

      // æå–å…³é”®è¯
      function extractKeywords(text) {
        const words = text.split(/[\s,ï¼Œã€‚!ï¼?ï¼Ÿ;ï¼›ã€]+/).filter(w => w.length > 1);
        const wordCount = new Map();
        
        words.forEach(word => {
          wordCount.set(word, (wordCount.get(word) || 0) + 1);
        });
        
        return Array.from(wordCount.entries())
          .sort((a, b) => b[1] - a[1])
          .map(item => item[0]);
      }

      // ç¿»é¡µæ•ˆæœ
      let currentReportPage = 1;
      const totalReportPages = 3;

      function nextReportPage() {
        if (currentReportPage < totalReportPages) {
          document.querySelector('.report-page.active').classList.remove('active');
          currentReportPage++;
          document.querySelectorAll('.report-page')[currentReportPage - 1].classList.add('active');
          updatePageIndicator();
        }
      }

      function prevReportPage() {
        if (currentReportPage > 1) {
          document.querySelector('.report-page.active').classList.remove('active');
          currentReportPage--;
          document.querySelectorAll('.report-page')[currentReportPage - 1].classList.add('active');
          updatePageIndicator();
        }
      }

      function updatePageIndicator() {
        const indicator = document.querySelector('.page-indicator');
        if (indicator) {
          indicator.textContent = `${currentReportPage} / ${totalReportPages}`;
        }
      }

      // å®æ—¶æ—¶é—´æ›´æ–°
      let timeUpdateInterval = null;

      function updateCurrentTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        
        const timeString = `${year}å¹´${month}æœˆ${day}æ—¥ ${hours}:${minutes}:${seconds}`;
        const timeElement = document.getElementById('currentTime');
        if (timeElement) {
          timeElement.textContent = timeString;
        }
      }

      function startTimeUpdate() {
        if (timeUpdateInterval) {
          clearInterval(timeUpdateInterval);
        }
        timeUpdateInterval = setInterval(updateCurrentTime, 1000);
      }

      // æ•°æ®å†å²ç›¸å…³å‡½æ•°
      let currentFilter = 'all';

      function showDataHistory() {
        const modal = document.getElementById('dataHistoryModal');
        modal.style.display = 'flex';
        currentFilter = 'all';
        loadDataHistory();
      }

      function filterData(type) {
        currentFilter = type;
        // æ›´æ–°æ ‡ç­¾é¡µæ¿€æ´»çŠ¶æ€
        document.querySelectorAll('.filter-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        event.target.classList.add('active');
        loadDataHistory();
      }

      function loadDataHistory() {
        const listDiv = document.getElementById('dataHistoryList');
        const allRecords = getRecords();
        
        // æ ¹æ®ç­›é€‰æ¡ä»¶è¿‡æ»¤æ•°æ®
        let filteredRecords = allRecords;
        if (currentFilter !== 'all') {
          filteredRecords = allRecords.filter(r => r.type === currentFilter);
        }
        
        // æŒ‰æ—¶é—´å€’åºæ’åˆ—
        filteredRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        if (filteredRecords.length === 0) {
          listDiv.innerHTML = `
            <div class="no-data">
              <div class="no-data-icon">ğŸ“­</div>
              <p>æš‚æ— æ•°æ®</p>
            </div>
          `;
          return;
        }
        
        // ç”Ÿæˆæ•°æ®åˆ—è¡¨
        let html = '';
        filteredRecords.forEach(record => {
          const date = new Date(record.timestamp);
          const dateStr = `${date.getFullYear()}å¹´${String(date.getMonth() + 1).padStart(2, '0')}æœˆ${String(date.getDate()).padStart(2, '0')}æ—¥ ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`;
          
          let typeLabel = '';
          let moodEmoji = '';
          let content = '';
          
          if (record.type === 'mood') {
            typeLabel = 'å¿ƒæƒ…è®°å½•';
            const moodLabels = ['å¾ˆç³Ÿç³•', 'ä¸å¤ªå¥½', 'ä¸€èˆ¬èˆ¬', 'è¿˜ä¸é”™', 'éå¸¸å¥½'];
            const moodEmojis = ['ğŸ˜¢', 'ğŸ˜•', 'ğŸ˜', 'ğŸ™‚', 'ğŸ˜„'];
            moodEmoji = moodEmojis[parseInt(record.mood) - 1];
            content = `<div class="data-item-content"><strong>${moodLabels[parseInt(record.mood) - 1]}</strong></div>`;
            if (record.text) {
              content += `<div class="data-item-content">${record.text}</div>`;
            }
          } else if (record.type === 'voice') {
            typeLabel = 'è¯­éŸ³æ—¥è®°';
            moodEmoji = 'ğŸ™ï¸';
            if (record.text) {
              content = `<div class="data-item-content">${record.text}</div>`;
            }
            if (record.audio) {
              content += `<div class="data-item-audio"><audio controls src="${record.audio}"></audio></div>`;
            }
          } else if (record.type === 'sound') {
            typeLabel = 'å£°éŸ³æ”¶è—';
            moodEmoji = 'ğŸ”Š';
            if (record.text) {
              content = `<div class="data-item-content">${record.text}</div>`;
            }
            if (record.audio) {
              content += `<div class="data-item-audio"><audio controls src="${record.audio}"></audio></div>`;
            }
          }
          
          html += `
            <div class="data-item">
              <div class="data-item-header">
                <div>
                  <span class="data-item-mood">${moodEmoji}</span>
                  <span class="data-item-type">${typeLabel}</span>
                </div>
                <span class="data-item-date">${dateStr}</span>
              </div>
              ${content}
            </div>
          `;
        });
        
        listDiv.innerHTML = html;
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      window.addEventListener('DOMContentLoaded', init);
    </script>
  </body>
</html>